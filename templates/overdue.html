<script>
async function api(url) {
  const r = await fetch(url);
  if (!r.ok) {
    throw new Error("API Error");
  }
  return await r.json();
}

async function load() {
  try {
    // âœ… SERVER-SIDE OVERDUE DATA
    const rows = await api('/api/overdue');

    const tb = document.querySelector('#tbl tbody');
    tb.innerHTML = '';

    if (rows.length === 0) {
      tb.innerHTML = `
        <tr>
          <td colspan="9" class="text-center text-muted">
            No overdue devices ðŸŽ‰
          </td>
        </tr>
      `;
      return;
    }

    rows.forEach((r, i) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${i + 1}</td>
        <td>${r.type || ''}</td>
        <td>${r.customer || ''}</td>
        <td>${r.phone || ''}</td>
        <td>${r.model || ''}</td>
        <td>${r.problem || ''}</td>
        <td>${r.receive_date || ''}</td>
        <td>
          <span class="badge bg-danger">
            ${r.status}
          </span>
        </td>
        <td>
          <button class="btn btn-sm btn-primary"
            onclick="window.open('/print/${r.id}','_blank')">
            Print
          </button>
        </td>
      `;
      tb.appendChild(tr);
    });

  } catch (e) {
    alert("Failed to load overdue list");
    console.error(e);
  }
}

load();
</script>