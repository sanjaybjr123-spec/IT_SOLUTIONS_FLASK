{% extends "base.html" %}
{% block content %}

<h4 class="mb-3">ğŸ“’ Ledger</h4>

<div class="card p-3 mb-3">
  <input id="search" class="form-control"
         placeholder="Search customer by name / mobile"
         onkeyup="searchCustomer()">
</div>

<div id="results" class="list-group mb-4"></div>

<hr>

<div class="card p-3">
  <h6>â• Add New Customer</h6>

  <input id="c_name" class="form-control mb-2" placeholder="Customer Name">
  <input id="c_mobile" class="form-control mb-2" placeholder="Mobile No">
  <input id="c_address" class="form-control mb-2" placeholder="Address">

  <button class="btn btn-success" onclick="addCustomer()">
    Add Customer
  </button>
</div>

<script>
async function searchCustomer(){
  const q = search.value;
  if(q.length < 2){
    results.innerHTML = "";
    return;
  }

  const r = await fetch(`/api/customers/search?q=${q}`);
  const data = await r.json();

  let html = "";
  data.forEach(c=>{
    html += `
      <div class="list-group-item">
        <b>${c.name}</b><br>
        ğŸ“ ${c.mobile}<br>
        ğŸ  ${c.address}
      </div>
    `;
  });

  results.innerHTML = html || "<div class='text-muted'>No customer found</div>";
}

async function addCustomer(){
  if(!c_name.value || !c_mobile.value)
    return alert("Name & Mobile required");

  await fetch("/api/customers",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      name:c_name.value,
      mobile:c_mobile.value,
      address:c_address.value
    })
  });

  c_name.value="";
  c_mobile.value="";
  c_address.value="";

  alert("Customer added");
}
</script>

{% endblock %}