{% extends "base.html" %}
{% block content %}

<h4>üñ®Ô∏è Ink Stock Management</h4>

<div class="row g-3">

<div class="col-md-6">
<div class="card p-3">
<h6>Add Stock</h6>

<select id="ink_in" class="form-select mb-2"></select>
<input id="qty_in" type="number" class="form-control mb-2" placeholder="Quantity">
<button class="btn btn-success w-100" onclick="addStock()">ADD</button>
</div>
</div>

<div class="col-md-6">
<div class="card p-3">
<h6>Sell Ink</h6>

<select id="ink_sell" class="form-select mb-2"></select>
<input id="qty_sell" type="number" class="form-control mb-2" placeholder="Quantity">
<button class="btn btn-danger w-100" onclick="sellStock()">SELL</button>
</div>
</div>

</div>

<hr>

<table class="table table-bordered mt-3">
<thead>
<tr><th>Ink</th><th>Qty</th><th>Status</th></tr>
</thead>
<tbody id="tbl"></tbody>
</table>

<script>
async function api(u,o={}){return (await fetch(u,o)).json()}

async function load(){
 const d=await api('/api/ink')
 let i='',t=''
 d.forEach(x=>{
   i+=`<option value="${x.id}">${x.model}</option>`
   let c=x.qty<5?'üî¥':x.qty<=10?'üü°':'üü¢'
   t+=`<tr><td>${x.model}</td><td>${x.qty}</td><td>${c}</td></tr>`
 })
 ink_in.innerHTML=i
 ink_sell.innerHTML=i
 tbl.innerHTML=t
}
async function addStock(){
 await api('/api/ink/in',{method:'POST',headers:{'Content-Type':'application/json'},
 body:JSON.stringify({id:ink_in.value,qty:qty_in.value})})
 load()
}
async function sellStock(){
 await api('/api/ink/sell',{method:'POST',headers:{'Content-Type':'application/json'},
 body:JSON.stringify({id:ink_sell.value,qty:qty_sell.value})})
 load()
}
load()
</script>

{% endblock %}